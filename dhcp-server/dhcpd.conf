#
# Gateway DHCP server configuration (Salt managed)
#
{%- set dhcp_prefixes = salt['pillar.get']("nodes:" ~ grains["id"] ~ ":dhcp:server:prefixes", []) %}
# The ddns-updates-style parameter controls whether or not the server will
# attempt to do a DNS update when a lease is confirmed. We default to the
# behavior of the version 2 packages ('none', since DHCP v2 didn't
# have support for DDNS.)
ddns-update-style none;
log-facility local7;

default-lease-time 600;
max-lease-time 3600;

# Use Anycast DNS server(s)
option domain-name-servers 10.132.251.53;

{% for prefix in dhcp_prefixes %}
# {{ prefix["description"] }}
subnet {{ prefix["network"] }} netmask {{ prefix["netmask"] }} {
	pool {
		# monitor: 75% 90% Y {{ grains['nodename'] }}/{{ prefix["description"] }} DHCP pool

		option routers {{ prefix["routers"] }};

  {%- if "ranges" in prefix %}
    {%- for range in prefix["ranges"] %}
		range {{ range }};
    {%- endfor %}
  {%- endif %}
	}
}

{% endfor %}
